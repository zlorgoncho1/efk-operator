# EFK Stack Operator Project Architecture

This document describes the organization and structure of the project.

## Directory Structure

```
efk/
├── api/                          # API definitions (CRDs)
│   └── v1/
│       ├── efkstack_types.go     # Go types for EFKStack CRD
│       ├── groupversion_info.go  # API group version information
│       └── zz_generated.*        # Generated code (deepcopy, etc.)
│
├── config/                       # Kubernetes manifests
│   ├── crd/                     # Custom Resource Definitions
│   │   ├── bases/               # Base CRDs
│   │   └── patches/             # CRD patches
│   ├── default/                 # Default configuration
│   ├── manager/                 # Manager manifests
│   ├── rbac/                    # RBAC (roles, bindings, service accounts)
│   └── samples/                 # EFKStack resource examples
│
├── docker/                       # Docker configuration
│   ├── Dockerfile               # Production image
│   ├── Dockerfile.dev           # Development image
│   └── docker-compose.yml       # Compose for dev environment
│
├── docs/                        # Documentation
│   ├── README.md                # Documentation index
│   ├── GETTING_STARTED.md       # Getting started guide
│   ├── USER_GUIDE.md            # User guide
│   ├── TESTING.md               # Complete testing guide
│   └── ARCHITECTURE.md          # This file
│
├── hack/                        # Scripts and utilities
│   └── boilerplate.go.txt       # Header for generated files
│
├── helm-charts/                 # Helm charts for components
│   └── efk-stack/
│       ├── Chart.yaml           # Main chart metadata
│       ├── values.yaml           # Default values
│       ├── values-development.yaml  # Development values
│       ├── values-production.yaml   # Production values
│       ├── elasticsearch/        # Elasticsearch chart
│       ├── fluentbit/            # Fluent Bit chart
│       └── kibana/               # Kibana chart
│
├── internal/                     # Internal code (not exposed)
│   ├── controller/              # Controllers
│   │   ├── efkstack_controller.go      # Main controller
│   │   ├── efkstack_controller_test.go # Controller tests
│   │   └── suite_test.go              # Test suite
│   └── helm/                     # Helm client
│       └── client.go             # Helm client for deployment
│
├── scripts/                      # Utility scripts
│   ├── test-all.sh              # Test script (Linux/Mac)
│   └── test-all.ps1             # Test script (Windows)
│
├── .gitignore                    # Files ignored by Git
├── .dockerignore                 # Files ignored by Docker
├── go.mod                        # Go dependencies
├── go.sum                        # Dependency checksums
├── main.go                       # Operator entry point
├── Makefile                      # Main Makefile
├── Makefile.kubebuilder          # Kubebuilder Makefile
├── PROJECT                       # Kubebuilder configuration
└── README.md                     # Main documentation
```

## Directory Descriptions

### `api/`
Contains Custom Resource Definition (CRD) definitions in Go. The `zz_generated.*` files are automatically generated by `controller-gen`.

### `config/`
Kubernetes manifests for:
- **crd/**: CRD definitions
- **rbac/**: Roles and permissions
- **manager/**: Manager deployment
- **samples/**: Usage examples

### `docker/`
Docker configuration for development and production:
- **Dockerfile.dev**: Development environment with all tools
- **Dockerfile**: Production image for the operator
- **docker-compose.yml**: Dev environment orchestration

### `docs/`
All project documentation:
- Getting started and usage guides
- Technical documentation
- Testing guides

### `helm-charts/`
Helm charts to deploy EFK components:
- Individual charts for each component
- Values files for different environments

### `internal/`
Internal code not exposed:
- **controller/**: Reconciliation logic
- **helm/**: Helm client to manage deployments

### `scripts/`
Utility scripts to automate tasks (tests, build, etc.)

## Important Files

### `main.go`
Operator entry point. Configures the manager and starts controllers.

### `Makefile`
Contains main commands for:
- Build and test
- Code generation
- Deployment
- Docker management

### `go.mod` / `go.sum`
Go dependency management.

### `PROJECT`
Kubebuilder configuration (domain, repo, etc.)

## Helm Charts Organization

Each component (Elasticsearch, Fluent Bit, Kibana) has its own chart in `helm-charts/efk-stack/`:

```
helm-charts/efk-stack/
├── elasticsearch/
│   ├── Chart.yaml
│   ├── values.yaml
│   └── templates/
│       ├── statefulset.yaml
│       ├── service.yaml
│       └── ...
├── fluentbit/
│   └── ...
└── kibana/
    └── ...
```

## Conventions

- **Go Code**: Follows standard Go conventions
- **Helm Charts**: Follows Helm conventions
- **Documentation**: Markdown in `docs/`
- **Scripts**: Bash for Linux/Mac, PowerShell for Windows

## Generated Files

The following files are automatically generated and should **not** be modified manually:

- `api/**/zz_generated.*`: Code generated by controller-gen
- `config/crd/bases/*.yaml`: Generated CRDs
- `bin/`: Compiled binaries

## Learn More

- [Getting Started Guide](GETTING_STARTED.md)
- [Testing Guide](TESTING.md)
- [User Guide](USER_GUIDE.md)
- [Main README](../README.md)

